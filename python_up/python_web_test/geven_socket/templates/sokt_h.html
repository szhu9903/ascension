<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>websocket客户端</title>
</head>
<body>

<script type="text/javascript">
    var user_base = {
        user_name:'szhu',
        user_brith: 1997,
        user_age: function () {
            // 顶层函数先获取this
            var that = this;
            function age() {
                var year = new Date().getFullYear();
                return year - that.user_brith;
            }
            return age();
        }
    }
</script>

<script type="text/javascript">
    // 利用filter函数去重，筛选获得不重复数据第一个
    var arr = ['apple', 'strawberry', 'banana', 'pear', 'apple', 'orange', 'orange', 'strawberry'];
    var r = arr.filter(function (element, index, self) {
        return self.indexOf(element) === index;
    });
    console.log(r);

    //创建父类
    var Student = {
        name:'name',
        height:1.3,
        fun:function () {
            console.log('class name: '+ this.name);
        }
    };

    function createUser(name) {
        var new_user = Object.create(Student);
        new_user.name = name;
        return new_user;
    }

    var szhu = createUser('szhu');
    szhu.fun();

    //class 继承




</script>


<script type="application/javascript">
    

    window.onload = function () {
        console.log("onload");
        var ws = new WebSocket('ws://127.0.0.1:8005/wsmsg/conn/');
        var sleep = function (time) {
            var endTime = new Date().getTime() + parseInt(time, 10);
            while (new Date().getTime() < endTime){}
        };
        console.log(ws);

        ws.onopen = function() {
            ws.send("INFO Start New Websocket");
        };
        ws.onmessage = function(e) {
            // 获取节点列表
            var message_list = document.getElementById("message");
            // 创建插入的元素
            var recv_data = document.getElementById("recv_id");
            if (recv_data){
                recv_data.innerText = e.data;
            }else {
                recv_data = document.createElement('p');
                recv_data.id = 'recv_id';
                recv_data.innerText = e.data;
                // 插入元素
                message_list.appendChild(recv_data);
            }
            sleep(5000);
            ws.onopen();

            // ws.close();
        };

        ws.onclose = function(e) {
            console.log("connection closed (" + e.code + ")");
        };

        ws.onerror = function(e) {
            console.log("connection errored");
        };
    };
</script>
<div id="message"></div>
<ol id="test-list">
    <li class="lang">Scheme</li>
    <li class="lang">JavaScript</li>
    <li class="lang">Python</li>
    <li class="lang">Ruby</li>
    <li class="lang">Haskell</li>
</ol>
<script type="text/javascript">
    var li_list = document.getElementById('test-list').children;
    var arr = []; i = 0; j = 0;
    for (; i<li_list.length; i++){
        arr.push(li_list[i].innerText);
    }
    arr.sort();
    for (; j<arr.length; j++){
        li_list[j].innerText = arr[j];
    }
</script>

<script type="text/javascript">
    // g更急
    var request;
    if (window.XMLHttpRequest) {
        request = new XMLHttpRequest();
    }else {
        request = new ActiveXObject('microsoft.XMLHTTP');
    }
    // 定义成功、失败方法
    function success(text){
        var li_list = document.getElementById('test-list');
        var new_data = li_list.lastElementChild;
        new_data.innerText = text;
        li_list.appendChild(new_data);

    }
    function fail(code) {
        var li_list = document.getElementById('test-list');
        var new_data = li_list.lastElementChild;
        new_data.innerText = code;
        li_list.appendChild(new_data);
    }
    // 检测状态发生变化，回调函数
    request.onreadystatechange = function () {
        if (request.readyState === 4){
            console.log(request);
            if(request.status === 200){
                success(request.responseText);
            }else {
                fail(request.status);
            }
        } else{
            console.log('loading...');
        }
    };

    request.open('GET','http://127.0.0.1:8005/api/v1.0/config/hardwareequip/');
    request.send();


</script>
</body>
</html>